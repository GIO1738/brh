<!DOCTYPE html>
<html>
<head>
  <title>Private Video Access</title>
</head>
<body>

<script type="module">
  // Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    updateDoc,
    deleteDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  // Firebase config (yours)
  const firebaseConfig = {
    apiKey: "AIzaSyABMybp4wDs-ZgwCLe_RN_Lvysi4HG20CQ",
    authDomain: "godeloos-d25f7.firebaseapp.com",
    projectId: "godeloos-d25f7",
    storageBucket: "godeloos-d25f7.firebasestorage.app",
    messagingSenderId: "817411167041",
    appId: "1:817411167041:web:9f346caa327689f01e47c0"
  };

  // Init Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Ask for password
  const input = prompt("Enter your access password:");

  if (!input) {
    alert("No password entered");
    document.body.innerHTML = "";
    throw new Error("No password");
  }

  // Check Firestore
  const snapshot = await getDocs(collection(db, "accessCodes"));
  let found = false;

  snapshot.forEach(async (docSnap) => {
    const data = docSnap.data();

    if (data.password === input) {
      found = true;

      if (data.usesLeft <= 0) {
        await deleteDoc(doc(db, "accessCodes", docSnap.id));
        alert("This password has expired");
        return;
      }

      // Decrease usage
      await updateDoc(doc(db, "accessCodes", docSnap.id), {
        usesLeft: data.usesLeft - 1
      });

      // Redirect ONLY to allowed YouTube link
      window.location.href = data.url;
    }
  });

  if (!matched) {
    alert("Invalid or expired password");
    document.body.innerHTML = "";
  }
</script>

</body>
</html>

  
  
